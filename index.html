<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pomodoro</title>

  <style>
    :root { color-scheme: light dark; }

    /* IMPORTANT: transparency */
    html, body {
      margin: 0;
      padding: 0;
      background: transparent;
    }

    /* a “glass” card that still looks good over any background */
    .wrap {
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 16px;
      box-sizing: border-box;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    .card {
      width: min(520px, 100%);
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.10);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.18);
      padding: 18px 18px 16px;
      box-sizing: border-box;
    }

    .top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }

    .mode {
      display: inline-flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    button, select {
      border: 1px solid rgba(255,255,255,0.22);
      background: rgba(0,0,0,0.18);
      color: inherit;
      padding: 10px 12px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      line-height: 1;
    }

    button[aria-pressed="true"] {
      background: rgba(255,255,255,0.22);
    }

    .time {
      font-size: 76px;
      font-weight: 800;
      letter-spacing: -2px;
      text-align: center;
      margin: 8px 0 14px;
      user-select: none;
    }

    .controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .meta {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      opacity: 0.95;
      font-size: 14px;
    }

    .meta .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.10);
    }

    .hint {
      margin-top: 10px;
      font-size: 12px;
      opacity: 0.8;
      text-align: center;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card" role="application" aria-label="Pomodoro timer">
      <div class="top">
        <div class="mode" aria-label="Mode">
          <button id="btnWork" aria-pressed="true" type="button">Work</button>
          <button id="btnBreak" aria-pressed="false" type="button">Break</button>
        </div>

        <button id="btnReset" type="button" title="Reset">Reset</button>
      </div>

      <div class="time" id="time" aria-live="polite">25:00</div>

      <div class="controls">
        <button id="btnStartPause" type="button">Start</button>
        <button id="btnSkip" type="button" title="Skip to next">Skip</button>
      </div>

      <div class="meta">
        <div class="row">
          <span>Work</span>
          <select id="workMinutes" aria-label="Work minutes">
            <option>15</option><option>20</option><option selected>25</option>
            <option>30</option><option>40</option><option>50</option>
          </select>
        </div>

        <div class="row">
          <span>Break</span>
          <select id="breakMinutes" aria-label="Break minutes">
            <option>3</option><option selected>5</option><option>10</option><option>15</option>
          </select>
        </div>

        <div class="row">
          <span>Autostart</span>
          <button id="toggleAutostart" type="button" aria-pressed="false">Off</button>
        </div>

        <div class="row">
          <span>Sound</span>
          <button id="toggleSound" type="button" aria-pressed="false">Off</button>
        </div>
      </div>

      <div class="hint">
        URL params: <code>?minutes=25&break=5&autostart=0&sound=0&bg=transparent</code>
      </div>
    </div>
  </div>

  <script>
    // ----- helpers -----
    const qs = new URLSearchParams(location.search);
    const clampInt = (v, min, max, fallback) => {
      const n = parseInt(v, 10);
      return Number.isFinite(n) ? Math.min(max, Math.max(min, n)) : fallback;
    };
    const fmt = (s) => {
      const m = Math.floor(s / 60);
      const r = s % 60;
      return String(m).padStart(2, "0") + ":" + String(r).padStart(2, "0");
    };

    // ----- state -----
    let workM = clampInt(qs.get("minutes"), 1, 120, 25);
    let breakM = clampInt(qs.get("break"), 1, 60, 5);
    let autostart = (qs.get("autostart") === "1");
    let soundOn = (qs.get("sound") === "1");

    let mode = "work";               // "work" | "break"
    let remaining = workM * 60;      // seconds
    let running = false;
    let intervalId = null;

    // transparent bg toggle (default transparent anyway)
    const bg = (qs.get("bg") || "transparent").toLowerCase();
    if (bg !== "transparent") {
      document.documentElement.style.background = bg;
      document.body.style.background = bg;
    }

    // ----- elements -----
    const elTime = document.getElementById("time");
    const btnStartPause = document.getElementById("btnStartPause");
    const btnReset = document.getElementById("btnReset");
    const btnSkip = document.getElementById("btnSkip");
    const btnWork = document.getElementById("btnWork");
    const btnBreak = document.getElementById("btnBreak");

    const selWork = document.getElementById("workMinutes");
    const selBreak = document.getElementById("breakMinutes");
    const toggleAutostart = document.getElementById("toggleAutostart");
    const toggleSound = document.getElementById("toggleSound");

    // init selects from params
    const setSelect = (sel, value) => {
      [...sel.options].forEach(o => { if (parseInt(o.value,10) === value) sel.value = String(value); });
    };
    setSelect(selWork, workM);
    setSelect(selBreak, breakM);

    const updatePressed = () => {
      btnWork.setAttribute("aria-pressed", mode === "work");
      btnBreak.setAttribute("aria-pressed", mode === "break");
      toggleAutostart.setAttribute("aria-pressed", autostart);
      toggleAutostart.textContent = autostart ? "On" : "Off";
      toggleSound.setAttribute("aria-pressed", soundOn);
      toggleSound.textContent = soundOn ? "On" : "Off";
    };

    const render = () => {
      elTime.textContent = fmt(remaining);
      btnStartPause.textContent = running ? "Pause" : "Start";
      updatePressed();
      // update title so it looks nice in browser tabs too
      document.title = `${mode === "work" ? "Work" : "Break"} · ${fmt(remaining)}`;
    };

    const beep = () => {
      if (!soundOn) return;
      // WebAudio simple beep (no external assets)
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = "sine";
      o.frequency.value = 880;
      g.gain.value = 0.03;
      o.connect(g); g.connect(ctx.destination);
      o.start();
      setTimeout(() => { o.stop(); ctx.close(); }, 220);
    };

    const stop = () => {
      running = false;
      if (intervalId) clearInterval(intervalId);
      intervalId = null;
      render();
    };

    const start = () => {
      if (running) return;
      running = true;
      const tick = () => {
        remaining -= 1;
        if (remaining <= 0) {
          remaining = 0;
          render();
          beep();
          // switch modes
          mode = (mode === "work") ? "break" : "work";
          remaining = (mode === "work" ? workM : breakM) * 60;

          if (!autostart) stop();
          else render();
          return;
        }
        render();
      };
      intervalId = setInterval(tick, 1000);
      render();
    };

    const setMode = (nextMode) => {
      mode = nextMode;
      remaining = (mode === "work" ? workM : breakM) * 60;
      stop();
      render();
    };

    // ----- events -----
    btnStartPause.addEventListener("click", async () => {
      // ensure audio works when user has interacted
      if (running) stop();
      else start();
    });

    btnReset.addEventListener("click", () => {
      remaining = (mode === "work" ? workM : breakM) * 60;
      stop();
      render();
    });

    btnSkip.addEventListener("click", () => {
      mode = (mode === "work") ? "break" : "work";
      remaining = (mode === "work" ? workM : breakM) * 60;
      stop();
      render();
      if (autostart) start();
    });

    btnWork.addEventListener("click", () => setMode("work"));
    btnBreak.addEventListener("click", () => setMode("break"));

    selWork.addEventListener("change", () => {
      workM = clampInt(selWork.value, 1, 120, 25);
      if (mode === "work") {
        remaining = workM * 60;
        stop();
      }
      render();
    });

    selBreak.addEventListener("change", () => {
      breakM = clampInt(selBreak.value, 1, 60, 5);
      if (mode === "break") {
        remaining = breakM * 60;
        stop();
      }
      render();
    });

    toggleAutostart.addEventListener("click", () => {
      autostart = !autostart;
      render();
    });

    toggleSound.addEventListener("click", () => {
      soundOn = !soundOn;
      render();
    });

    // first render
    render();
  </script>
</body>
</html>
